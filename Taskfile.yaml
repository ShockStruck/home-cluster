version: '3'

tasks:
  rook-ceph-toolbox:
    desc: Exec into Rook Ceph toolbox
    cmds:
      - kubectl -n rook-ceph exec -it $(kubectl -n rook-ceph get pod -l "app=rook-ceph-tools" -o jsonpath='{.items[0].metadata.name}') -- bash

  rook-password:
    desc: Retrieve Rook dashboard password
    cmds:
      - kubectl -n rook-ceph get secret rook-ceph-dashboard-password -o jsonpath="{['data']['password']}" | base64 --decode && echo

  pgo-fix-permission:
    desc: Fix data directory permission bug
    cmds:
      - kubectl exec -it $(kubectl get pod -l "postgres-operator.crunchydata.com/role=master" -o jsonpath='{.items[0].metadata.name}') -c database -- chmod 700 /pgdata/pg14
      - kubectl exec -it $(kubectl get pod -l "postgres-operator.crunchydata.com/role=replica" -o jsonpath='{.items[0].metadata.name}') -c database -- chmod 700 /pgdata/pg14
